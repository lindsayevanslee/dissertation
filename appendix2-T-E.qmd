---
title: "T-E"
format:
  html:
    page-layout: full
---

## Paris, BnF Arsenal, 3516

Digitization available via Gallica [HERE](https://gallica.bnf.fr/ark:/12148/btv1b55000507q/f232.item).

```{r te-setup, include=FALSE}
# Load the xml2 package
library(xml2)
```

::: {.column-page-outset}
::: {layout="[[6,6,6]]"}

::: {.column}
### Minimal

```{r te-minimal, results='asis'}
# START OF "MINIMAL" CODE
# Read the XML content
xml_file <- read_xml("data/T-E.xml")

# Extract both <l>, <cb>, and <pb> elements
lines <- xml_find_all(xml_file, "//text//l | //text//cb | //text//pb")

# Initialize an empty list to store the processed lines
processed_lines <- list()

# Initialize line counter
line_count <- 0

# Function to process each element
process_line <- function(line) {
  # Handle page breaks differently
  if (xml_name(line) == "pb") {
    # Get folio number and format as standalone line
    folio_num <- xml_attr(line, "n")
    return(sprintf("<div class='folio-number'>%s</div>", folio_num))
  }
  
  # Only increment line count for verse lines
  if (xml_name(line) == "l") {
    line_count <<- line_count + 1
      
    # SPECIAL CASE: Hard-code line v.366 to fix "]cio(n)" repetition
    if (line_count == 366) {
      return("<div style='line-height: 1.2;'>Nonpas p bone ente [] cio</div>")
    }  
      
    # SPECIAL CASE: Hard-code line v.439 to correct spacing
    if (line_count == 439) {
      return("<div style='line-height: 1.2;'>Virge roine jo croi bien</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.523 to fix "Virge Roine" spacing
    if (line_count == 523) {
      return("<div style='line-height: 1.2;'>Virge Roine coronee</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.703 to correct nesting/repetition issue
    if (line_count == 703) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='2'>O</span>rlairomes ci deMarie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1495 to fix "Sire Deus" spacing
    if (line_count == 1495) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1495</span>Sire Deus loes foiestu</div>")
    }
    
    # Add line number div every 5th line
    line_number <- if (line_count %% 5 == 0) {
      sprintf("<div class='line-number'>%d</div>", line_count)
    } else {
      ""
    }
  } else {
    line_number <- ""
  }
  
  # Process emph elements (decorative initials)
  emph_elements <- xml_find_all(line, ".//emph")
  for (emph in emph_elements) {
    # Get the initial letter text
    initial_letter <- xml_text(emph)
    
    # Get the size attribute (n) and style attribute (rend)
    size_attr <- xml_attr(emph, "n")
    style_attr <- xml_attr(emph, "rend")
    
    # Create the HTML for the styled initial
    styled_initial <- sprintf('<span class="decorative-initial %s" data-size="%s">%s</span>', 
                             style_attr, size_attr, initial_letter)
    
    # Replace the emph element with the styled HTML
    xml_text(emph) <- styled_initial
  }
  
  # Find all <choice> elements within the line
  choices <- xml_find_all(line, ".//choice")
  for (choice in choices) {
    # Extract the text from the <orig> tag
    orig_text <- xml_text(xml_find_first(choice, ".//orig"))
    # Remove the <choice> element and replace it with the text from the <orig> tag
    xml_set_text(choice, paste0(orig_text, " "))
  }
  
  # Now we want to remove any <reg> elements entirely
  reg_elements <- xml_find_all(line, ".//reg")
  xml_remove(reg_elements)
  
  # Replace <lb/> tags with HTML line break
  lb_elements <- xml_find_all(line, ".//lb")
  for (lb in lb_elements) {
    xml_set_text(lb, "")
  }
  
  # Return line with number if applicable - using xml_text() instead of as.character()
  return(sprintf("<div style='line-height: 1.2;'>%s%s</div>", 
                line_number, xml_text(line)))
}

# Process each line and wrap with <div class='column-break'> at each <cb/>
for (line in lines) {
  if (xml_name(line) == "cb") {
    # Add a closing </div> for the previous column and an opening <div> for the new column
    processed_lines <- c(processed_lines, "</div>", "<div class='column-break'>")
  } else {
    # Process the line and add it to the current column
    processed_lines <- c(processed_lines, process_line(line))
  }
}

# Process lines and wrap in edition-text div
formatted_text <- paste(c("<div class='edition-text'>", processed_lines, "</div>"), collapse = "\n")
cat(formatted_text)

```

:::

::: {.column}
### Intermediate

```{r te-intermediate, results='asis'}
# START OF "INTERMEDIATE" CODE
# Read the XML content
xml_file <- read_xml("data/T-E.xml")

# Extract the <l>, <cb>, and <pb> elements inside the <text> element
lines <- xml_find_all(xml_file, "//text//l | //text//cb | //text//pb")

# Initialize an empty list to store the processed lines
processed_lines <- list()

# Initialize line counter
line_count <- 0

# Function to process each element
process_line <- function(line) {
  # Handle page breaks differently
  if (xml_name(line) == "pb") {
    # Get folio number and format as standalone line
    folio_num <- xml_attr(line, "n")
    return(sprintf("<div class='folio-number'>%s</div>", folio_num))
  }
  
  # Only increment line count for verse lines
  if (xml_name(line) == "l") {
    line_count <<- line_count + 1
    
    # SPECIAL CASE: Hard-code line v.5 to correct apostrophe
    if (line_count == 5) {
      return("<div style='line-height: 1.2;'><span class='line-number'>5</span>Bien croi que volentiers lorront</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.8 to correct spacing
    if (line_count == 8) {
      return("<div style='line-height: 1.2;'>Est saparole & aspre & dure</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.21 to correct spacing
    if (line_count == 21) {
      return("<div style='line-height: 1.2;'>Se hom guerpist lamerci De</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.22 to correct accent
    if (line_count == 22) {
      return("<div style='line-height: 1.2;'>cis pechies niert ja pardone</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.38 to correct apostrophe
    if (line_count == 38) {
      return("<div style='line-height: 1.2;'>tant quil sent al cuer lamort</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.52 to correct spacing
    if (line_count == 52) {
      return("<div style='line-height: 1.2;'>Quilifera donques aide</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.65 to correct apostrophe
    if (line_count == 65) {
      return("<div style='line-height: 1.2;'><span class='line-number'>65</span>Por ce quel est tant bele & gente</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.67 to correct spacing
    if (line_count == 67) {
      return("<div style='line-height: 1.2;'>Ne limembroit pas demorir</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.77 to correct spacing
    if (line_count == 77) {
      return("<div style='line-height: 1.2;'>Neprisoit casti deparent</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.78 to correct apostrophe
    if (line_count == 78) {
      return("<div style='line-height: 1.2;'>Nient plus quun trespas de vent</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.80 to correct spacing
    if (line_count == 80) {
      return("<div style='line-height: 1.2;'><span class='line-number'>80</span>Car croi le conseil detonpere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.94 to correct apostrophe
    if (line_count == 94) {
      return("<div style='line-height: 1.2;'>Jamais anul jor nen ert lies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.95 to correct apostrophe
    if (line_count == 95) {
      return("<div style='line-height: 1.2;'><span class='line-number'>95</span>& maldist tote saventure</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.99 to correct apostrophe
    if (line_count == 99) {
      return("<div style='line-height: 1.2;'>tresquele avoit passe -xii- anz</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.104 to correct apostrophe
    if (line_count == 104) {
      return("<div style='line-height: 1.2;'>puis noirent parler de li</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.114 to correct apostrophe
    if (line_count == 114) {
      return("<div style='line-height: 1.2;'>des jovencels avoit lamor</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.126 to correct accent
    if (line_count == 126) {
      return("<div style='line-height: 1.2;'>od les garcons aloit juer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.131 to correct apostrophe
    if (line_count == 131) {
      return("<div style='line-height: 1.2;'>Que devant sen huis enlentree</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.133 to correct apostrophe
    if (line_count == 133) {
      return("<div style='line-height: 1.2;'>par ce quil erent si ami</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.136 to correct apostrophe
    if (line_count == 136) {
      return("<div style='line-height: 1.2;'>Sentredonoient grant colees</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.158 to correct spacing
    if (line_count == 158) {
      return("<div style='line-height: 1.2;'>Sicom il est en escripture</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.163 to correct spacing
    if (line_count == 163) {
      return("<div style='line-height: 1.2;'>onques com tesse ne roine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.174 to correct accent
    if (line_count == 174) {
      return("<div style='line-height: 1.2;'>Ne parceuscies mesfacon</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.181 to correct spacing
    if (line_count == 181) {
      return("<div style='line-height: 1.2;'>blans bras avoit &blances mains</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.182 to correct spacing
    if (line_count == 182) {
      return("<div style='line-height: 1.2;'>lesdoisreonsgreilles &plains</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.183 to correct spacing
    if (line_count == 183) {
      return("<div style='line-height: 1.2;'>Gent cors avoit &bienmolle</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.185 to correct spacing
    if (line_count == 185) {
      return("<div style='line-height: 1.2;'><span class='line-number'>185</span>Netrop grande netrop petite</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.187 to correct spacing
    if (line_count == 187) {
      return("<div style='line-height: 1.2;'>lagrans biautesdecestedame</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.188 to correct spacing
    if (line_count == 188) {
      return("<div style='line-height: 1.2;'>Niert toute escriteparnulhomme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.189 to correct spacing
    if (line_count == 189) {
      return("<div style='line-height: 1.2;'>Tant ert cortoise deparler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.190 to correct spacing
    if (line_count == 190) {
      return("<div style='line-height: 1.2;'><span class='line-number'>190</span>Rien ni avoit queamender</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.192 to correct spacing
    if (line_count == 192) {
      return("<div style='line-height: 1.2;'>Quant deson Creatornacure</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.197 to correct spacing
    if (line_count == 197) {
      return("<div style='line-height: 1.2;'>Navoit pas soing dedrasdelaine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.202 to correct spacing
    if (line_count == 202) {
      return("<div style='line-height: 1.2;'>chaucoit atus les jors del an</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.204 to correct apostrophe
    if (line_count == 204) {
      return("<div style='line-height: 1.2;'>lamoient tot por sa biaute</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.212 to correct apostrophe
    if (line_count == 212) {
      return("<div style='line-height: 1.2;'>Quele ert de haut parente</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.223 to correct spacing
    if (line_count == 223) {
      return("<div style='line-height: 1.2;'>tote ert plaine depelerins</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.233 to correct accent
    if (line_count == 233) {
      return("<div style='line-height: 1.2;'>Mais quant les aparcut Marie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.234 to correct spacing
    if (line_count == 234) {
      return("<div style='line-height: 1.2;'>Nepuet muer quene sen rie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.239 to correct spacing
    if (line_count == 239) {
      return("<div style='line-height: 1.2;'>Quilpart en iront cil baron</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.245 to correct spacing
    if (line_count == 245) {
      return("<div style='line-height: 1.2;'><span class='line-number'>245</span>dont li respondi li preu dom</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.254 to correct spacing
    if (line_count == 254) {
      return("<div style='line-height: 1.2;'>Nepuet muer quene senrie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.260 to correct apostrophe
    if (line_count == 260) {
      return("<div style='line-height: 1.2;'><span class='line-number'>260</span>Si com lemenoit saventure</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.272 to correct apostrophe
    if (line_count == 272) {
      return("<div style='line-height: 1.2;'>Ci sui venue dautre regne</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.292 to correct spacing
    if (line_count == 292) {
      return("<div style='line-height: 1.2;'>Cil del dromont liplus leger</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.294 to correct apostrophe
    if (line_count == 294) {
      return("<div style='line-height: 1.2;'>Tres quil vindrent en haute mer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.296 to correct spacing
    if (line_count == 296) {
      return("<div style='line-height: 1.2;'>En haute mer drecent lorvoiles</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.302 to correct spacing
    if (line_count == 302) {
      return("<div style='line-height: 1.2;'>&entussens alosengier</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.305 to correct spacing
    if (line_count == 305) {
      return("<div style='line-height: 1.2;'><span class='line-number'>305</span>Quien peust prendre respit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.306 to correct spacing
    if (line_count == 306) {
      return("<div style='line-height: 1.2;'>Quene pechast enli la nuit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.308 to correct spacing
    if (line_count == 308) {
      return("<div style='line-height: 1.2;'>Quetos les fist ensoi pecher</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.321 to correct spacing
    if (line_count == 321) {
      return("<div style='line-height: 1.2;'>Amolt grant gres les recevoit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.323 to correct spacing
    if (line_count == 323) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='2'>M</span>erveille fu cevoirement</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.334 to correct spacing
    if (line_count == 334) {
      return("<div style='line-height: 1.2;'>Neset quefaire la caitive</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.337 to correct spacing
    if (line_count == 337) {
      return("<div style='line-height: 1.2;'>A laparfin sest porpensel</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.343 to correct spacing
    if (line_count == 343) {
      return("<div style='line-height: 1.2;'>Onques ne setint depecher</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.351 to correct spacing
    if (line_count == 351) {
      return("<div style='line-height: 1.2;'>Car molt decevoit sajovente</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.352 to correct apostrophe
    if (line_count == 352) {
      return("<div style='line-height: 1.2;'>por co quele ert bele & gente</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.357 to correct apostrophe
    if (line_count == 357) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='1'>L</span>i jors vint delAcension</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.359 to correct apostrophe
    if (line_count == 359) {
      return("<div style='line-height: 1.2;'>des pelerins doutre lemer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.363 to correct accent
    if (line_count == 363) {
      return("<div style='line-height: 1.2;'>& quant les aparcoit Marie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.366 to fix "]cio(n)" repetition
    if (line_count == 366) {
      return("<div style='line-height: 1.2;'>Nonpas par bone enten [] cion</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.370 to correct apostrophe
    if (line_count == 370) {
      return("<div style='line-height: 1.2;'><span class='line-number'>370</span>o eus neust ja compaignie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.371 to correct accent
    if (line_count == 371) {
      return("<div style='line-height: 1.2;'>atant les degres sont monte</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.373 to correct spacing
    if (line_count == 373) {
      return("<div style='line-height: 1.2;'>tot en tra ens lacompaignie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.377 to correct spacing
    if (line_count == 377) {
      return("<div style='line-height: 1.2;'>Que lisambloient chevaliers</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.386 to correct apostrophe
    if (line_count == 386) {
      return("<div style='line-height: 1.2;'>Que doit quele nipuet entrer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.394 to correct spacing
    if (line_count == 394) {
      return("<div style='line-height: 1.2;'>Grant cors se fiert en lapoitrine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.398 to correct spacing
    if (line_count == 398) {
      return("<div style='line-height: 1.2;'>commar i fustes meretris</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.401 to correct spacing
    if (line_count == 401) {
      return("<div style='line-height: 1.2;'>mal con seil ai tostans eu</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.414 to correct spacing
    if (line_count == 414) {
      return("<div style='line-height: 1.2;'>Qui en ton cors portas tonpare</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.438 to correct spacing
    if (line_count == 438) {
      return("<div style='line-height: 1.2;'>Molt ert aspre mapenitance</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.439 to correct spacing
    if (line_count == 439) {
      return("<div style='line-height: 1.2;'>Virge roine jo croi bien</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.449 to correct spacing
    if (line_count == 449) {
      return("<div style='line-height: 1.2;'>molt fu grant merveille delPere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.450 to correct spacing
    if (line_count == 450) {
      return("<div style='line-height: 1.2;'><span class='line-number'>450</span>Quant de safille fist saMere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.453 to correct spacing
    if (line_count == 453) {
      return("<div style='line-height: 1.2;'>Il fu tes Fiex & fu tesPere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.454 to correct spacing
    if (line_count == 454) {
      return("<div style='line-height: 1.2;'>Tu fus sa Fille & saMere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.458 to correct spacing
    if (line_count == 458) {
      return("<div style='line-height: 1.2;'>parcoi dyables fu destruis</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.477 to correct apostrophe
    if (line_count == 477) {
      return("<div style='line-height: 1.2;'>dist quil estoit li Aignels Dei</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.483 to correct spacing
    if (line_count == 483) {
      return("<div style='line-height: 1.2;'>Si com il fist lepremer homme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.484 to correct spacing
    if (line_count == 484) {
      return("<div style='line-height: 1.2;'>Que il fist manger delapomme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.497 to correct spacing
    if (line_count == 497) {
      return("<div style='line-height: 1.2;'>Fors en jeta sacompaignie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.523 to fix "Virge Roine" spacing
    if (line_count == 523) {
      return("<div style='line-height: 1.2;'>Virge Roine coronee</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.524 to correct spacing
    if (line_count == 524) {
      return("<div style='line-height: 1.2;'>Qui tant pares bone euree</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.526 to correct spacing
    if (line_count == 526) {
      return("<div style='line-height: 1.2;'>Que tos limons nepot reprendre</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.527 to correct spacing
    if (line_count == 527) {
      return("<div style='line-height: 1.2;'>Sicom jo croi ce que jo di</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.573 to correct spacing
    if (line_count == 573) {
      return("<div style='line-height: 1.2;'>Son chief lava de lapardonne</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.581 to correct spacing
    if (line_count == 581) {
      return("<div style='line-height: 1.2;'>par matin ala almoster</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.588 to correct spacing
    if (line_count == 588) {
      return("<div style='line-height: 1.2;'>outre passa leflun Jordan</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.598 to correct spacing
    if (line_count == 598) {
      return("<div style='line-height: 1.2;'>orcommenca sapenitance</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.599 to correct spacing
    if (line_count == 599) {
      return("<div style='line-height: 1.2;'>Napas talent derepentir</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.600 to correct spacing
    if (line_count == 600) {
      return("<div style='line-height: 1.2;'><span class='line-number'>600</span>Ains se lairoit defaim morir</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.634 to correct spacing
    if (line_count == 634) {
      return("<div style='line-height: 1.2;'>& en v iron sachar noircie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.635 to correct spacing
    if (line_count == 635) {
      return("<div style='line-height: 1.2;'><span class='line-number'>635</span>itant avoit noir lementon</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.640 to correct spacing
    if (line_count == 640) {
      return("<div style='line-height: 1.2;'><span class='line-number'>640</span>molt vos venist agrant merveille</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.643 to correct spacing
    if (line_count == 643) {
      return("<div style='line-height: 1.2;'>Noire & molsue ert sapoitrine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.646 to remove apostrophe in "qu'il"
    if (line_count == 646) {
      return("<div style='line-height: 1.2;'>Nient plus quil est en .i. gans</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.650 to remove apostrophe in "qu'ele"
    if (line_count == 650) {
      return("<div style='line-height: 1.2;'><span class='line-number'>650</span>asdens les ront quele ot trencans</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.662 to correct spacing
    if (line_count == 662) {
      return("<div style='line-height: 1.2;'>Quant ele avoit lagrant hascie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.672 to correct spacing
    if (line_count == 672) {
      return("<div style='line-height: 1.2;'>com ce fuissent pieres demur</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.690 to remove apostrophe in "qu'ele"
    if (line_count == 690) {
      return("<div style='line-height: 1.2;'><span class='line-number'>690</span>Quele jadis soloit amer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.703 to correct nesting/repetition issue
    if (line_count == 703) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='2'>O</span>rlairommes ci deMarie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.714 to correct apostrophe
    if (line_count == 714) {
      return("<div style='line-height: 1.2;'>Navoient pas vestu stamine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.718 to correct spacing
    if (line_count == 718) {
      return("<div style='line-height: 1.2;'>Nefuissent ja trove en lit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.719 to correct spacing
    if (line_count == 719) {
      return("<div style='line-height: 1.2;'>tote jor erent elmoster</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.720 to correct spacing
    if (line_count == 720) {
      return("<div style='line-height: 1.2;'><span class='line-number'>720</span>fors seul al eure demanger</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.722 to correct spacing
    if (line_count == 722) {
      return("<div style='line-height: 1.2;'>depain dorge & de polment</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.729 to correct apostrophe
    if (line_count == 729) {
      return("<div style='line-height: 1.2;'>Navoient soig dargent ne dor</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.731 to correct accent
    if (line_count == 731) {
      return("<div style='line-height: 1.2;'>Nul dels navoit propriete</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.739 to correct accent
    if (line_count == 739) {
      return("<div style='line-height: 1.2;'>Quant les avoit acommenchies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.748 to correct spacing
    if (line_count == 748) {
      return("<div style='line-height: 1.2;'>Fors seul .ii. quila remanoient</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.750 to correct apostrophe
    if (line_count == 750) {
      return("<div style='line-height: 1.2;'><span class='line-number'>750</span>Quil cremissent de lor maison</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.774 to correct spacing
    if (line_count == 774) {
      return("<div style='line-height: 1.2;'>por la paor queil aront</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.793 to correct spacing
    if (line_count == 793) {
      return("<div style='line-height: 1.2;'>li paistre ert liesdeson bergil</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.799 to correct spacing
    if (line_count == 799) {
      return("<div style='line-height: 1.2;'>Quant revient al jor dequaresme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.807 to correct spacing
    if (line_count == 807) {
      return("<div style='line-height: 1.2;'>Uns senva adestre partie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.810 to correct spacing
    if (line_count == 810) {
      return("<div style='line-height: 1.2;'><span class='line-number'>810</span>molt ert vestus depovresdras</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.811 to correct accent
    if (line_count == 811) {
      return("<div style='line-height: 1.2;'>miex amoit il sa poverte</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.812 to correct accent
    if (line_count == 812) {
      return("<div style='line-height: 1.2;'>Que nus quens ne fait sa conte</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.813 to correct spacing
    if (line_count == 813) {
      return("<div style='line-height: 1.2;'>Enlaforest par fondement</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.816 to correct accent
    if (line_count == 816) {
      return("<div style='line-height: 1.2;'>de Deu voloit o eus parle</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.819 to correct apostrophe
    if (line_count == 819) {
      return("<div style='line-height: 1.2;'>& vit quenul nenpot trover</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.820 to correct apostrophe
    if (line_count == 820) {
      return("<div style='line-height: 1.2;'><span class='line-number'>820</span>Not corage davant aler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.832 to correct apostrophe
    if (line_count == 832) {
      return("<div style='line-height: 1.2;'>Qui plus valoit cargent neor</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.836 to correct spacing
    if (line_count == 836) {
      return("<div style='line-height: 1.2;'>Reclama Deu om ni potent</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.843 to correct spacing
    if (line_count == 843) {
      return("<div style='line-height: 1.2;'>Environ lui avoit sacrine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.844 to correct apostrophe
    if (line_count == 844) {
      return("<div style='line-height: 1.2;'>tant ert blance comflordespine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.845 to correct apostrophe
    if (line_count == 845) {
      return("<div style='line-height: 1.2;'><span class='line-number'>845</span>li blanc cevoil nierent trecies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.862 to correct accent
    if (line_count == 862) {
      return("<div style='line-height: 1.2;'>dont commenca fort aplorer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.872 to correct apostrophe
    if (line_count == 872) {
      return("<div style='line-height: 1.2;'>Son vis nosa torner vers lomme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.883 to correct apostrophe
    if (line_count == 883) {
      return("<div style='line-height: 1.2;'>de lautrepart Marie estoit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.886 to correct accent
    if (line_count == 886) {
      return("<div style='line-height: 1.2;'>A lui commenca aparler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.890 to correct spacing
    if (line_count == 890) {
      return("<div style='line-height: 1.2;'><span class='line-number'>890</span>de mon noir cors quesiest lasques</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.894 to correct accent
    if (line_count == 894) {
      return("<div style='line-height: 1.2;'>de pec commenca aplorer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.924 to correct spacing
    if (line_count == 924) {
      return("<div style='line-height: 1.2;'>por le pitie queil avoit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.926 to correct apostrophe
    if (line_count == 926) {
      return("<div style='line-height: 1.2;'>par la barbe quil ot chenue</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.932 to correct accent
    if (line_count == 932) {
      return("<div style='line-height: 1.2;'>tu mas beneicon requis</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.937 to correct spacing
    if (line_count == 937) {
      return("<div style='line-height: 1.2;'>con gie as demesse canter</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.941 to correct spacing
    if (line_count == 941) {
      return("<div style='line-height: 1.2;'>jo croi bien que parton seignacle</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.944 to correct apostrophe
    if (line_count == 944) {
      return("<div style='line-height: 1.2;'>& li vins sans quen issi fors</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.947 to correct apostrophe
    if (line_count == 947) {
      return("<div style='line-height: 1.2;'>Car tu las servi detenfance</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.973 to correct spacing
    if (line_count == 973) {
      return("<div style='line-height: 1.2;'>des rois des contes de laterre</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.976 to correct spacing
    if (line_count == 976) {
      return("<div style='line-height: 1.2;'>confaitement il se con tienent</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.978 to correct spacing
    if (line_count == 978) {
      return("<div style='line-height: 1.2;'>Dexamis pais par tot lemont</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.979 to correct spacing
    if (line_count == 979) {
      return("<div style='line-height: 1.2;'>Nus ne va itant parlaterre</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.980 to correct spacing
    if (line_count == 980) {
      return("<div style='line-height: 1.2;'><span class='line-number'>980</span>Qui loie mais parler degerre</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.981 to correct spacing
    if (line_count == 981) {
      return("<div style='line-height: 1.2;'>mais sainte eglise agrant beson</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.993 to correct spacing
    if (line_count == 993) {
      return("<div style='line-height: 1.2;'>deterre fu senpers ravie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.994 to correct spacing
    if (line_count == 994) {
      return("<div style='line-height: 1.2;'>Queele ni aivenoit mie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.996 to correct spacing
    if (line_count == 996) {
      return("<div style='line-height: 1.2;'>mais Damledeu trait agarant</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.998 to correct spacing
    if (line_count == 998) {
      return("<div style='line-height: 1.2;'>Avoit entre laterre & li</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1002 to correct accent
    if (line_count == 1002) {
      return("<div style='line-height: 1.2;'>commenca sent aler lepas</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1006 to correct accent
    if (line_count == 1006) {
      return("<div style='line-height: 1.2;'>Sel commenca a apeler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1008 to correct spacing
    if (line_count == 1008) {
      return("<div style='line-height: 1.2;'>bieaus chiers pare porcoi tenvas</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1009 to correct spacing
    if (line_count == 1009) {
      return("<div style='line-height: 1.2;'>porcoi doutas por une feme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1010 to correct spacing
    if (line_count == 1010) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1010</span>Saches quejo sui crestiene</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1020 to correct spacing
    if (line_count == 1020) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1020</span>apres commenca aparler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1021 to correct spacing
    if (line_count == 1021) {
      return("<div style='line-height: 1.2;'>dont est venue & dequel tere b</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1022 to correct spacing
    if (line_count == 1022) {
      return("<div style='line-height: 1.2;'>Zosimasliprist aenquerre a</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1025 to correct spacing
    if (line_count == 1025) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1025</span>dilemoi par con fession</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1033 to correct spacing
    if (line_count == 1033) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='2'>D</span>ont commence aconter Marie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1037 to correct apostrophe
    if (line_count == 1037) {
      return("<div style='line-height: 1.2;'>Endementres quele liconte</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1038 to correct apostrophe
    if (line_count == 1038) {
      return("<div style='line-height: 1.2;'>bien poes croi re quele ot honte</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1085 to correct apostrophe
    if (line_count == 1085) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1085</span>perequant tu maporteras</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1086 to correct spacing
    if (line_count == 1086) {
      return("<div style='line-height: 1.2;'>plus fort de toi metraveras</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1093 to correct spacing
    if (line_count == 1093) {
      return("<div style='line-height: 1.2;'>Iluec serai a com munie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1095 to correct spacing
    if (line_count == 1095) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1095</span>desque passai leflun Jordan</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1106 to correct spacing
    if (line_count == 1106) {
      return("<div style='line-height: 1.2;'>molt ot grant duel quant il lepart</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1107 to correct spacing
    if (line_count == 1107) {
      return("<div style='line-height: 1.2;'>Alaterre est a jenoillies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1109 to correct spacing
    if (line_count == 1109) {
      return("<div style='line-height: 1.2;'>baise laterre molt sovent</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1115 to correct spacing
    if (line_count == 1115) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1115</span>puis li menbra de sonmoster</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1125 to correct accent
    if (line_count == 1125) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1125</span><span class='decorative-initial' data-size='2'>A</span>pres quant ce vint al quareme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1127 to correct spacing
    if (line_count == 1127) {
      return("<div style='line-height: 1.2;'>En son lit jut dansZosimas</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1131 to correct spacing
    if (line_count == 1131) {
      return("<div style='line-height: 1.2;'>Sot que voire ert laprophesie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1133 to correct spacing
    if (line_count == 1133) {
      return("<div style='line-height: 1.2;'>tote passa la quarent aine</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1136 to correct spacing
    if (line_count == 1136) {
      return("<div style='line-height: 1.2;'>dont apris corpus domni</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1140 to correct accent
    if (line_count == 1140) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1140</span>Quant ele prist alui congie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1141 to correct spacing
    if (line_count == 1141) {
      return("<div style='line-height: 1.2;'>Zosimasaenpris son oire</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1146 to correct spacing
    if (line_count == 1146) {
      return("<div style='line-height: 1.2;'>Quant il vint la molt parfumas</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1149 to correct spacing
    if (line_count == 1149) {
      return("<div style='line-height: 1.2;'>Co ert larien queplus doutoit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1148 to correct apostrophe
    if (line_count == 1148) {
      return("<div style='line-height: 1.2;'>mais en cor nen iavoit mie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1161 to correct spacing
    if (line_count == 1161) {
      return("<div style='line-height: 1.2;'>mais senevient amoi parler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1189 to correct accent
    if (line_count == 1189) {
      return("<div style='line-height: 1.2;'>apres li est cheue as pies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1190 to correct accent
    if (line_count == 1190) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1190</span>Car molt se crient deses pecies</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1192 to correct spacing
    if (line_count == 1192) {
      return("<div style='line-height: 1.2;'>Re quiert li sa beneicon</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1202 to correct accent
    if (line_count == 1202) {
      return("<div style='line-height: 1.2;'>commenca le a acoler</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1207 to correct accent
    if (line_count == 1207) {
      return("<div style='line-height: 1.2;'>ladame respont apres lui</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1209 to correct spacing
    if (line_count == 1209) {
      return("<div style='line-height: 1.2;'>Quant orent fait lor par lement</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1213 to correct spacing
    if (line_count == 1213) {
      return("<div style='line-height: 1.2;'>Zosimas le tint ensamain</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1218 to correct spacing
    if (line_count == 1218) {
      return("<div style='line-height: 1.2;'>Janus navera paradis</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1224 to correct apostrophe
    if (line_count == 1224) {
      return("<div style='line-height: 1.2;'>par le sanc quissi de saplaie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1233 to correct spacing
    if (line_count == 1233) {
      return("<div style='line-height: 1.2;'>li sainslot issi des raisner</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1234 to correct spacing
    if (line_count == 1234) {
      return("<div style='line-height: 1.2;'>molt sen commence amerveiller</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1244 to correct spacing
    if (line_count == 1244) {
      return("<div style='line-height: 1.2;'>& si me rent mon gerre don</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1282 to correct apostrophe
    if (line_count == 1282) {
      return("<div style='line-height: 1.2;'>Quele navoit mangie de ble</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1334 to correct spacing
    if (line_count == 1334) {
      return("<div style='line-height: 1.2;'>tant parlevolt Dex honorer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1335 to correct spacing
    if (line_count == 1335) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1335</span>Sigrant miracle Dex ifist</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1337 to correct spacing
    if (line_count == 1337) {
      return("<div style='line-height: 1.2;'>Ne por froidor nepor chalor</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1339 to correct spacing & accent
    if (line_count == 1339) {
      return("<div style='line-height: 1.2;'>Tant fu li cors des enterres</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1343 to correct spacing
    if (line_count == 1343) {
      return("<div style='line-height: 1.2;'>mais dune rien fumolt iries</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1345 to correct accent
    if (line_count == 1345) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1345</span>Que a la dame avoit parle</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1349 to correct spacing
    if (line_count == 1349) {
      return("<div style='line-height: 1.2;'>ancois eust pris le con giet</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1353 to correct spacing
    if (line_count == 1353) {
      return("<div style='line-height: 1.2;'>Eldesert vint por lamoiller</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1354 to correct spacing
    if (line_count == 1354) {
      return("<div style='line-height: 1.2;'>dont avoit sigrant de sirier</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1355 to correct spacing
    if (line_count == 1355) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1355</span>tant laquist il par le desert</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1359 to correct spacing
    if (line_count == 1359) {
      return("<div style='line-height: 1.2;'>Il fait grant duel & plore &crie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1360 to correct apostrophe
    if (line_count == 1360) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1360</span>pres ert delcors nen veoit mie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1362 to correct spacing
    if (line_count == 1362) {
      return("<div style='line-height: 1.2;'>mostre moi co quetant ai quis</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1364 to correct apostrophe
    if (line_count == 1364) {
      return("<div style='line-height: 1.2;'>Navant na riere nen irai</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1365 to correct spacing
    if (line_count == 1365) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1365</span>des que jo voie cele feme</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1367 to correct spacing
    if (line_count == 1367) {
      return("<div style='line-height: 1.2;'>Sire mostre moi lamoiller</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1390 to correct apostrophe
    if (line_count == 1390) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1390</span>poi sen faloit queniert totnu</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1397 to correct accent
    if (line_count == 1397) {
      return("<div style='line-height: 1.2;'>les pies commenca a baisier</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1401 to correct spacing
    if (line_count == 1401) {
      return("<div style='line-height: 1.2;'>En ces letres quelisainsvit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1406 to correct spacing
    if (line_count == 1406) {
      return("<div style='line-height: 1.2;'>proie porlui par ta merci</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1409 to correct spacing
    if (line_count == 1409) {
      return("<div style='line-height: 1.2;'>En laterre erent fi gurees</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1414 to correct spacing
    if (line_count == 1414) {
      return("<div style='line-height: 1.2;'>dont son service a com mencie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1419 to correct spacing
    if (line_count == 1419) {
      return("<div style='line-height: 1.2;'>dont il peust laterre ovrir</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1427 to correct spacing
    if (line_count == 1427) {
      return("<div style='line-height: 1.2;'>Grant mestier alisains daue</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1428 to correct spacing
    if (line_count == 1428) {
      return("<div style='line-height: 1.2;'>tel ahan a quetot tressue</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1437 to correct accent
    if (line_count == 1437) {
      return("<div style='line-height: 1.2;'>les pies commenca alecier</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1447 to correct accent
    if (line_count == 1447) {
      return("<div style='line-height: 1.2;'>mais puis quant il levoit prive</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1464 to correct spacing
    if (line_count == 1464) {
      return("<div style='line-height: 1.2;'>commenca laterre a fuir</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1465 to correct spacing
    if (line_count == 1465) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1465</span>li lions fuet laterre dure</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1479 to correct spacing
    if (line_count == 1479) {
      return("<div style='line-height: 1.2;'>Or fait lacommandacion</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1483 to correct spacing
    if (line_count == 1483) {
      return("<div style='line-height: 1.2;'>mais quant cevint alacovrer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1485 to correct spacing
    if (line_count == 1485) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1485</span>tote laterre rasamble</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1489 to correct spacing
    if (line_count == 1489) {
      return("<div style='line-height: 1.2;'>a laterre est ajenoilliet</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1490 to correct spacing
    if (line_count == 1490) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1490</span>Samblant fait deprandre congiet</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1492 to correct accent
    if (line_count == 1492) {
      return("<div style='line-height: 1.2;'>El grant de sert en est entres</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1493 to correct apostrophe
    if (line_count == 1493) {
      return("<div style='line-height: 1.2;'>Quant Zosimaslenvittorner</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1494 to correct spacing
    if (line_count == 1494) {
      return("<div style='line-height: 1.2;'>Deu en com menca aloer</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1495 to fix "Sire Deus" spacing
    if (line_count == 1495) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1495</span>Sire Deus loes foiestu</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1499 to correct spacing
    if (line_count == 1499) {
      return("<div style='line-height: 1.2;'>Orvoi & croi bien sansdoutance</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1518 to correct spacing
    if (line_count == 1518) {
      return("<div style='line-height: 1.2;'>En contre lui al flun Jordan</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1520 to correct spacing
    if (line_count == 1520) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1520</span>de leve quetant ert parfonde</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1542 to correct spacing
    if (line_count == 1542) {
      return("<div style='line-height: 1.2;'>denos armes al juge ment</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1544 to correct spacing
    if (line_count == 1544) {
      return("<div style='line-height: 1.2;'>con saut qui cest romans escrist</div>")
    }
    
    # Add line number div every 5th line
    line_number <- if (line_count %% 5 == 0) {
      sprintf("<div class='line-number'>%d</div>", line_count)
    } else {
      ""
    }
  } else {
    line_number <- ""
  }
  
  # Process emph elements (decorative initials)
  emph_elements <- xml_find_all(line, ".//emph")
  for (emph in emph_elements) {
    # Get the initial letter text
    initial_letter <- xml_text(emph)
    
    # Get the size attribute (n) and style attribute (rend)
    size_attr <- xml_attr(emph, "n")
    style_attr <- xml_attr(emph, "rend")
    
    # Create the HTML for the styled initial
    styled_initial <- sprintf('<span class="decorative-initial %s" data-size="%s">%s</span>', 
                             style_attr, size_attr, initial_letter)
    
    # Replace the emph element with the styled HTML
    xml_text(emph) <- styled_initial
  }
  
  # Find all <choice> elements within the line
  choices <- xml_find_all(line, ".//choice")
  for (choice in choices) {
    # Check if the <choice> element contains <abbr> and <expan>
    abbr_exists <- xml_find_first(choice, ".//abbr")
    expan_exists <- xml_find_first(choice, ".//expan")
    
    if (!is.na(abbr_exists) && !is.na(expan_exists)) {
      # If <abbr> and <expan> tags exist, extract only the <reg> text from <expan>
      reg_text <- xml_text(xml_find_first(choice, ".//expan/reg"))
      xml_set_text(choice, paste0(reg_text, " "))
    } else {
      # For non-abbreviation choices, keep original behavior
      orig_text <- xml_text(xml_find_first(choice, ".//orig"))
      xml_set_text(choice, paste0(orig_text, " "))
    }
  }
  
  # Now we want to remove any <reg> elements entirely
  reg_elements <- xml_find_all(line, ".//reg")
  xml_remove(reg_elements)
  
  # Replace <lb/> tags with HTML line break
  lb_elements <- xml_find_all(line, ".//lb")
  for (lb in lb_elements) {
    xml_set_text(lb, "")
  }
  
  # Return line with number if applicable - using xml_text() instead of as.character()
  return(sprintf("<div style='line-height: 1.2;'>%s%s</div>", 
                line_number, xml_text(line)))
}

# Process each line and wrap with <div class='column-break'> at each <cb/>
for (line in lines) {
  if (xml_name(line) == "cb") {
    # Add a closing </div> for the previous column and an opening <div> for the new column
    processed_lines <- c(processed_lines, "</div>", "<div class='column-break'>")
  } else {
    # Process the line and add it to the current column
    processed_lines <- c(processed_lines, process_line(line))
  }
}

# Process lines and wrap in edition-text div
formatted_text <- paste(c("<div class='edition-text'>", processed_lines, "</div>"), collapse = "\n")
cat(formatted_text)

```

:::

::: {.column}
### Extensive

```{r te-extensive, results='asis'}
# START OF "EXTENSIVE" CODE
# Read the XML content
xml_file <- read_xml("data/T-E.xml")

# Extract the <l>, <cb>, and <pb> elements inside the <text> element
lines <- xml_find_all(xml_file, "//text//l | //text//cb | //text//pb")

# Initialize an empty list to store the processed lines
processed_lines <- list()

# Initialize line counter
line_count <- 0

# Function to process each element
process_line <- function(line) {
  # Handle page breaks differently
  if (xml_name(line) == "pb") {
    # Get folio number and format as standalone line
    folio_num <- xml_attr(line, "n")
    return(sprintf("<div class='folio-number'>%s</div>", folio_num))
  }
  
  # Only increment line count for verse lines
  if (xml_name(line) == "l") {
    line_count <<- line_count + 1
    
    # SPECIAL CASE: Hard-code line v.80 to correct "pere" repetition
    if (line_count == 80) {
      return("<div style='line-height: 1.2;'><span class='line-number'>80</span>Car croi le conseil de ton pere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.223 to fix "pelerins" repetition
    if (line_count == 223) {
      return("<div style='line-height: 1.2;'>tote ert plaine de pelerins</div>")
    }  
    
    # SPECIAL CASE: Hard-code line v.366 to fix "]cio(n)" repetition
    if (line_count == 366) {
      return("<div style='line-height: 1.2;'>Non pas par bone enten [] cion</div>")
    }
        
    # SPECIAL CASE: Hard-code line v.439 to correct spacing
    if (line_count == 439) {
      return("<div style='line-height: 1.2;'>Virge roine jo croi bien</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.449 to fix "Pere" repetition
    if (line_count == 449) {
      return("<div style='line-height: 1.2;'>molt fu grant merveille del Pere</div>")
    }
      
    # SPECIAL CASE: Hard-code line v.450 to fix "fille" and "Mere" repetition
    if (line_count == 450) {
      return("<div style='line-height: 1.2;'><span class='line-number'>450</span>Quant de sa fille fist sa Mere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.453 to fix "Pere" repetition
    if (line_count == 453) {
      return("<div style='line-height: 1.2;'>Il fu tes Fiex & fu tes Pere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.454 to fix "Mere" repetition
    if (line_count == 454) {
      return("<div style='line-height: 1.2;'>Tu fus sa Fille & sa Mere</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.523 to fix "Virge Roine" spacing
    if (line_count == 523) {
      return("<div style='line-height: 1.2;'>Virge Roine coronee</div>")
    }
      
    # SPECIAL CASE: Hard-code line v.703 to correct nesting/repetition issue
    if (line_count == 703) {
      return("<div style='line-height: 1.2;'><span class='decorative-initial' data-size='2'>O</span>r lairommes ci de Marie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.754 to fix "Deu" repetition
    if (line_count == 754) {
      return("<div style='line-height: 1.2;'>Que soit laissie le Deu service</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.806 to fix "Damledeu" repetition
    if (line_count == 806) {
      return("<div style='line-height: 1.2;'>A Damledeu les commandoit</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.840 to fix "Marie" repetition
    if (line_count == 840) {
      return("<div style='line-height: 1.2;'><span class='line-number'>840</span>la figure vit de Marie</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.977 to fix "Zosimas" repetition
    if (line_count == 977) {
      return("<div style='line-height: 1.2;'>dans Zosimas dont li respont</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1012 to fix "Deu" repetition
    if (line_count == 1012) {
      return("<div style='line-height: 1.2;'>En Deu ai tote ma creance</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1127 to fix "Zosimas" repetition
    if (line_count == 1127) {
      return("<div style='line-height: 1.2;'>En son lit jut dans Zosimas</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1412 to fix "D" repetition
    if (line_count == 1412) {
      return("<div style='line-height: 1.2;'>molt grant mercis en rent a D</div>")
    }
    
    # SPECIAL CASE: Hard-code line v.1495 to fix "Sire Deus" spacing
    if (line_count == 1495) {
      return("<div style='line-height: 1.2;'><span class='line-number'>1495</span>Sire Deus loes soies tu</div>")
    }
    
    # Add line number div every 5th line
    line_number <- if (line_count %% 5 == 0) {
      sprintf("<div class='line-number'>%d</div>", line_count)
    } else {
      ""
    }
  } else {
    line_number <- ""
  }
  
  # Process emph elements (decorative initials)
  emph_elements <- xml_find_all(line, ".//emph")
  for (emph in emph_elements) {
    # Get the initial letter text
    initial_letter <- xml_text(emph)
    
    # Get the size attribute (n) and style attribute (rend)
    size_attr <- xml_attr(emph, "n")
    style_attr <- xml_attr(emph, "rend")
    
    # Create the HTML for the styled initial
    styled_initial <- sprintf('<span class="decorative-initial %s" data-size="%s">%s</span>', 
                             style_attr, size_attr, initial_letter)
    
    # Replace the emph element with the styled HTML
    xml_text(emph) <- styled_initial
  }
  
  # Now we want to remove any <orig> elements entirely
  orig_elements <- xml_find_all(line, ".//orig")
  xml_remove(orig_elements)
  
  # Find all <choice> elements within the line
  choices <- xml_find_all(line, ".//choice")
  for (choice in choices) {
    # Extract the text from the <reg> tag
    reg_text <- xml_text(xml_find_first(choice, ".//reg"))
    # Replace the <choice> element with the text from the <reg> tag
    xml_set_text(choice, paste0(" ", reg_text, " "))
  }
  
  # Replace <lb/> tags with HTML line break
  lb_elements <- xml_find_all(line, ".//lb")
  for (lb in lb_elements) {
    xml_set_text(lb, "")
  }
  
  # Return line with number if applicable - using xml_text() instead of as.character()
  return(sprintf("<div style='line-height: 1.2;'>%s%s</div>", 
                line_number, xml_text(line)))
}

# Process each line and wrap with <div class='column-break'> at each <cb/>
for (line in lines) {
  if (xml_name(line) == "cb") {
    # Add a closing </div> for the previous column and an opening <div> for the new column
    processed_lines <- c(processed_lines, "</div>", "<div class='column-break'>")
  } else {
    # Process the line and add it to the current column
    processed_lines <- c(processed_lines, process_line(line))
  }
}

# Process lines and wrap in edition-text div
formatted_text <- paste(c("<div class='edition-text'>", processed_lines, "</div>"), collapse = "\n")
cat(formatted_text)

```

:::

:::

:::
